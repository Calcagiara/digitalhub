# Data Visualization

This example illustrates how to use the visualization components of the platform to visualize data stored or generated by other components.

The following components are used:

- PostgreSQL with TimescaleDB and PostGIS extensions
- MinIO
- Dremio
- Grafana
- Superset

## Deployment

*visualization.yml* file is used to start the components through Docker/Podman-Compose. You may want to update the services configured in the file if needed (e.g. to change the images).

Open a terminal, `cd` to the *docker-compose* folder and run the following Docker/Podman command:

```shell
podman-compose -p dh -f visualization.yml up -d
```

## Usage

**NOTE**: the following paragraphs assume you are using the default credentials configured in *visualization.yml*.

### Grafana

This section describes how to visualize data with Grafana using PostgreSQL and Dremio as data sources. The [virtualization use case](https://github.com/scc-digitalhub/digitalhub/blob/main/docs/expose_and_virtualize.md) is a prerequisite to this one, as the virtual dataset created with Dremio is reused in this example, although the steps to generate such dataset are not repeated here.

The instructions related to visualizing Postgres data also apply to the [mini ETL use case](https://github.com/scc-digitalhub/digitalhub/blob/main/docs/mini_ETL.md), however the table populated during the ETL execution is pre-populated in this example.

#### Connect to Postgres

The `digitalhub` database has a schema named `test_scenario` containing the table `cities`, which is automatically populated with some entries when the *docker-compose/resources/db-init-script/postgres-visualization.sql* script is executed.

Navigate to the Grafana UI at *http://localhost:10000* and log in with the credentials `admin`/`admin`. You can skip providing a new admin password. Open the *Configuration* page with the cog icon and add a new PostgreSQL data source. Configure it as follows:

- *Name*: `Digitalhub`
- *Host*: `postgres:5432`
- *Database*: `digitalhub`
- *User*: `postgres`
- *Password*: `postgres`
- *TLS/SSL Mode*: `disable`
- *Version*: `14`
- *TimescaleDB*: enable this

*Save & test* to verify that the connection is successful.

#### Connect to Dremio

The Grafana service loads a data source plugin, `digital-hub-dremio`, that allows to perform queries on Dremio. In order to use it, add a Grafana data source and select *Dremio* as type. Configure it as follows:

- *Name*: `Dremio`
- *URL*: `http://dremio:9047`
- *User*: `dremio`
- *Password*: `dremio123`

*Save & test* to verify that the connection is successful.

#### Visualize the Data

You can now open the *Dashboards* page and create a new dashboard to visualize data from both data sources. Here are the queries to create some example panels:

1. Visualize the table `cities` from Postgres with the following query:

```
SELECT * FROM test_scenario.cities;
```

2. Visualize the virtual dataset you created on Dremio (assuming it is named `london_air_quality_data` and saved in the home space of the `dremio` user):

```
SELECT measurement, CO, O3, PM5, NO2 FROM "@dremio".london_air_quality_data;
```

### Superset

**TODO**
